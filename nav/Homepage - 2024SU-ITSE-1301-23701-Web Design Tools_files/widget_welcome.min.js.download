var welcomeMessage,configDataPath,defaultData,widget={},roleDefs={},modFound=!1,topFound=!1,welcomeContent=[],totalNumberOfPages=0,showWelcomeOnLaunch=!0,gotSharedConfig=!1,welcomeModIndex=-1,welcomeTopIds=[],currentPage=1,tocObj={},myWidgetData=null,noDismissModal=!1,isEditor=!1,usingDefaultContent=!1,widgetPath=widgethost+"/widgets/welcome/"+v+"/",supportedLangs=["en-us","fr-ca","es-mx","pt-br"],terms={title:"Welcome Widget",step:"Step",of:"of",welcome:"Welcome",next:"Next",back:"Back",finish:"Finish",dismiss:"Dismiss",moduleTitle:"Welcome",buttonText:"Relaunch the Welcome Window",introText:"Relaunch the Welcome Window to review the information.",introTitle1:"IMPORTANT: Setting up the Welcome Window",introTitle2:"STEP 1: Decide what information you need to include",introTitle3:"STEP 2: Dismissing or recalling the Welcome Window",introTitle4:"STEP 3: Adding content and media to the Welcome Window",closeModal:"Close Welcome Modal"},configData={accentColor:"#006fbf",moduleTitle:"Welcome",buttonText:"Launch the Quick Guide",introText:"Welcome to the course!",background:widgetPath+"img/banner-default-corp-5.png",Modules:[],forceDismiss:!1,showDefaultContent:!0};configData.Modules=[{Title:"Welcome",Topics:[{TopicId:1,Title:"Get Started",Url:widgetPath+"config/welcome-1.html"},{TopicId:2,Title:"What to Include",Url:widgetPath+"config/welcome-2.html"},{TopicId:3,Title:"Customizing the Content",Url:widgetPath+"config/welcome-3.html"},{TopicId:4,Title:"Appearance and Dismissal Rules",Url:widgetPath+"config/welcome-4.html"}]}],(defaultData=configData).Modules=configData.Modules;var resizeId,_iOSDevice=!!navigator.platform.match(/iPhone|iPod|iPad/);function getConfig(){gotSharedConfig?parent.window.postMessage(JSON.stringify({subject:"doValenceRequest",message:{route:"getWidgetDataConfig",data:{}}}),"*"):parent.window.postMessage(JSON.stringify({subject:"doValenceRequest",message:{route:"getWidgetDataConfigOrg",data:{}}}),"*")}function welcomeInit(){parent.window.postMessage(JSON.stringify({subject:"setHTML",message:{htmlString:welcomeMessage,selector:"#welcomeModal #name-message"}}),"*");var e=!1,t=!0;loadDefaultContent()&&(tocObj.Modules=defaultData.Modules,tocObj.Modules[0].Title=configData.moduleTitle,configData.showDefaultContent&&isEditor||(t=!1));for(var s=0;s<tocObj.Modules.length;s++)if(tocObj.Modules[s].Title.toLowerCase().indexOf(configData.moduleTitle.toLowerCase())>-1&&(modFound=!0,welcomeModIndex=s,tocObj.Modules[s].Topics.length>0)){topFound=!0;for(var o=0;o<tocObj.Modules[s].Topics.length;o++){welcomeTopIds.push(tocObj.Modules[s].Topics[o].TopicId),0===o?'<li data-step="'+(o+1)+'" data-name="'+tocObj.Modules[s].Topics[o].Title+'"><span class="step-number step-number-active">'+terms.step+" "+(o+1)+'</span><span class="step-number-separator"> of </span></li>':o===tocObj.Modules[s].Topics.length-1?'<li data-step="'+(o+1)+'" data-name="'+tocObj.Modules[s].Topics[o].Title+'"><span class="step-number">'+(o+1)+"</span></li>":'<li data-step="'+(o+1)+'" data-name="'+tocObj.Modules[s].Topics[o].Title+'" class="hidden"><span class="step-number step-number-total">'+(o+1)+"</span></li>";var a={},i="";if(usingDefaultContent){var n=JSON.stringify({n:terms.next,d:terms.dismiss,b:configData.buttonText,m:configData.moduleTitle,s:terms.step,o:terms.of,t:tocObj.Modules[s].Topics[o].Title,fn:widget.user.nameFirst,i:configData.background,f:configData.forceDismiss,ba:terms.back});i="?langTerms="+encodeURIComponent(n)}a.Content=_iOSDevice?'<div class="content-frame" data-step="'+(o+1)+'" style=""><div class="side-banner"></div><div class="iframe-wrapper" style="width:100%; height:100%;-webkit-overflow-scrolling: touch;overflow:scroll;"><iframe title="'+tocObj.Modules[s].Topics[o].Title+'" src="'+tocObj.Modules[s].Topics[o].Url+i+'" style="width:100%; height:100%;"></iframe></div></div>':'<div class="content-frame" data-step="'+(o+1)+'" style=""><div class="side-banner"></div><iframe title="'+tocObj.Modules[s].Topics[o].Title+'" src="'+tocObj.Modules[s].Topics[o].Url+i+'" style="width:100%; height:100%;"></iframe></div>',a.Title=tocObj.Modules[s].Topics[o].Title,welcomeContent.push(a),totalNumberOfPages++}}!0===showWelcomeOnLaunch&&(void 0!==myWidgetData.Data.TopicIDs&&myWidgetData.Data.TopicIDs.equals(welcomeTopIds)&&(e=!0),topFound&&modFound&&t&&!e&&launchPopup(!0)),topFound&&modFound&&t&&($("#launch_welcome_btn").fadeIn(),resizeFrame()),modFound?modFound&&!topFound&&console.log('Welcome Message: Content Topics with "'+configData.moduleTitle+'" Module not found. Not showing link.'):console.log('Welcome Message: Matching Content Module titled "'+configData.moduleTitle+'" not found. Not showing link.')}function welcomeClose(){myWidgetData.Data.TopicIDs=welcomeTopIds,parent.window.postMessage(JSON.stringify({subject:"doValenceRequest",message:{route:"updateMyWidgetData",data:{myWidgetData:myWidgetData}}}),"*")}function loadDefaultContent(){for(var e=!0,t=0;t<tocObj.Modules.length;t++)tocObj.Modules[t].Title.toLowerCase().indexOf(configData.moduleTitle.toLowerCase())>-1&&tocObj.Modules[t].Topics.length>0&&(e=!1);return e&&(usingDefaultContent=!0),e}function buildModal(){var e,t=$('<div class="welcome-modal-bg lcs-modal-bg" id="welcomeModalBg">'),s=$('<div class="welcome-modal lcs-modal" role="dialog" aria-labelledby="welcomeModal" id="welcomeModal" data-keyboard="false" data-backdrop="static" tabindex="-1">'),o=$('<button title="'+terms.closeModal+'" class="btn-close close-modal" id="close-modal-welcome"></button>'),a=$('<div class="header" style="background-image:url('+configData.background+')">'),i=($('<div class="welcome-accent-bg">'),$('<p id="name-message" class="name-message">')),n=$('<h2 id="page-title" class="page-title"></h2>'),c=$('<div class="content"></div>'),r=$('<div class="step-nav">'),l=$("<p>"),d=$("<hr>"),g=$('<div class="steps" tabindex="0">'),m=$('<div class="navigation">'),u=$('<button class="btn-step btn-standard btn-back" id="step-back">').text(terms.back),p=$('<button class="btn-step btn-primary btn-next" id="step-forward">').text(terms.next),f=$('<button class="btn-step btn-primary btn-dismiss" id="step-dismiss">').text(terms.dismiss);a.append(i,n),g.append(l),m.append(u,p,f),r.append(d,g,m),!1===configData.forceDismiss&&s.append(o),s.append(a,c,r),e=t[0].outerHTML+s[0].outerHTML,parent.window.postMessage(JSON.stringify({subject:"appendHTML",message:{datastring:e,tagname:"body",src:"",id:"buildModal"}}),"*")}function buildDependencies(){var e,t=document.createElement("link");t.href=widgetPath+"css/widget_welcome.min.css",t.rel="stylesheet",e=t.outerHTML,parent.window.postMessage(JSON.stringify({subject:"appendHTML",message:{datastring:e,tagname:"head",src:"",id:"buildDependencies"}}),"*")}function launchPopup(e){void 0===e&&(e=!1),currentPage=1,loadNav();topFound&&(parent.window.postMessage(JSON.stringify({subject:"setHTML",message:{htmlString:welcomeContent[currentPage-1].Title,selector:"#welcomeModal #page-title"}}),"*"),parent.window.postMessage(JSON.stringify({subject:"setHTML",message:{htmlString:welcomeContent[currentPage-1].Content,selector:"#welcomeModal .content"}}),"*"),parent.window.postMessage(JSON.stringify({subject:"setHTML",message:{htmlString:terms.step+" "+currentPage+" "+terms.of+" "+totalNumberOfPages,selector:"#welcomeModal .step-nav .steps"}}),"*"),e?(parent.window.postMessage(JSON.stringify({subject:"setCss",message:{selector:"#welcomeModal",cssObj:{display:"block"}}}),"*"),parent.window.postMessage(JSON.stringify({subject:"setCss",message:{selector:"#welcomeModalBg",cssObj:{display:"block"}}}),"*")):(parent.window.postMessage(JSON.stringify({subject:"changeVisibility",message:{state:"show",selector:"#welcomeModal",focus:!0,interval:250}}),"*"),parent.window.postMessage(JSON.stringify({subject:"changeVisibility",message:{state:"show",selector:"#welcomeModalBg",focus:!1,interval:250}}),"*")),parent.window.postMessage(JSON.stringify({subject:"trapFocus",message:{selector:"#welcomeModal"}}),"*"))}function loadNav(){currentPage<totalNumberOfPages?(parent.window.postMessage(JSON.stringify({subject:"changeVisibility",message:{state:"hide",selector:"#step-dismiss",focus:!1,interval:0}}),"*"),parent.window.postMessage(JSON.stringify({subject:"changeVisibility",message:{state:"show",focus:!0,selector:"#step-forward",interval:0}}),"*")):(parent.window.postMessage(JSON.stringify({subject:"changeVisibility",message:{state:"show",focus:!0,selector:"#step-dismiss",interval:0}}),"*"),parent.window.postMessage(JSON.stringify({subject:"changeVisibility",message:{state:"hide",focus:!1,selector:"#step-forward",interval:0}}),"*")),currentPage>1?parent.window.postMessage(JSON.stringify({subject:"changeVisibility",message:{state:"show",focus:!0,selector:"#step-back",interval:0}}),"*"):parent.window.postMessage(JSON.stringify({subject:"changeVisibility",message:{state:"hide",focus:!1,selector:"#step-back",interval:0}}),"*")}function loadContent(){parent.window.postMessage(JSON.stringify({subject:"setHTML",message:{htmlString:welcomeContent[currentPage-1].Title,selector:"#welcomeModal #page-title"}}),"*"),parent.window.postMessage(JSON.stringify({subject:"setHTML",message:{htmlString:welcomeContent[currentPage-1].Content,selector:"#welcomeModal .content"}}),"*"),parent.window.postMessage(JSON.stringify({subject:"setHTML",message:{htmlString:terms.step+" "+currentPage+" "+terms.of+" "+totalNumberOfPages,selector:"#welcomeModal .step-nav .steps"}}),"*"),parent.window.postMessage(JSON.stringify({subject:"trapFocus",message:{selector:"#welcomeModal"}}),"*")}function processMyWidgetData(e){"Not Found"!==e&&"Forbidden"!==e?(myWidgetData=e).Data=JSON.parse(myWidgetData.Data):(myWidgetData={}).Data={};var t={OrgUnitId:widget.orgUnit.id};parent.window.postMessage(JSON.stringify({subject:"doValenceRequest",message:{route:"getTOC",data:t}}),"*")}function stepBack(){currentPage>1&&currentPage--,loadNav(),loadContent()}function stepForward(){currentPage<totalNumberOfPages&&currentPage++,loadNav(),loadContent()}function resizeFrame(){parent.window.postMessage(JSON.stringify({subject:"frameResize",message:$("body").outerHeight()+10+"px"}),"*")}String.prototype.trunc=function(e,t){var s=this.length>e,o=s?this.substr(0,e-1):this;return o=t&&s?o.substr(0,o.lastIndexOf(" ")):o,s?o+"&hellip;":o},Array.prototype.equals=function(e,t){if(!e)return!1;if(1===arguments.length&&(t=!0),this.length!==e.length)return!1;for(var s=0;s<this.length;s++)if(this[s]instanceof Array&&e[s]instanceof Array){if(!this[s].equals(e[s],t))return!1}else{if(t&&this[s]!==e[s])return!1;if(!t)return this.sort().equals(e.sort(),!0)}return!0},$(document).ready((function(){parent.window.postMessage(JSON.stringify({subject:"getReplaceStrings",message:""}),"*"),parent.window.postMessage(JSON.stringify({subject:"setFrameTitle",message:{title:"Welcome Widget"}}),"*"),window.addEventListener("message",events,!1),resizeFrame()})),$(window).resize((function(){clearTimeout(resizeId),resizeId=setTimeout(resizeFrame,500)}));const widgetObserver=new ResizeObserver(e=>{resizeFrame()}),bodyEl=document.querySelector("body");function addButtonEvents(){parent.window.postMessage(JSON.stringify({subject:"addEventListener",message:{id:"step-back",event:"click"}}),"*"),parent.window.postMessage(JSON.stringify({subject:"addEventListener",message:{id:"step-forward",event:"click"}}),"*"),parent.window.postMessage(JSON.stringify({subject:"addEventListener",message:{id:"step-dismiss",event:"click"}}),"*"),parent.window.postMessage(JSON.stringify({subject:"addEventListener",message:{id:"close-modal-welcome",event:"click"}}),"*")}function getLanguagePack(){parent.window.postMessage(JSON.stringify({subject:"getLangTerms",message:""}),"*")}function events(e){var t=JSON.parse(e.data);switch(t.subject){case"doneGetReplaceStrings":widget=t.message,getLanguagePack();break;case"doneGetRoleDefinitions":void 0!==(roleDefs=t.message)&&roleDefs.hasOwnProperty("editor")?roleDefs.editor.indexOf(widget.role.name)>-1&&(isEditor=!0):isEditor=!0,getConfig();break;case"doneGetLangTerms":if(terms=t.message,void 0===widget.user)return;welcomeMessage=terms.welcome+" "+widget.user.nameFirst,configData={accentColor:"#006fbf",moduleTitle:terms.moduleTitle,buttonText:terms.buttonText,introText:terms.introText,background:widgetPath+"img/banner-default-corp-5.png",forceDismiss:!1,showDefaultContent:!0,Modules:[]};var s="en-us";supportedLangs.indexOf(widget.instance.lang.toLowerCase())>-1&&(s=widget.instance.lang.toLowerCase()),configData.Modules=[{Title:terms.moduleTitle,Topics:[{TopicId:1,Title:terms.introTitle1,Url:widgetPath+"config/"+s+"/welcome-1.html"},{TopicId:2,Title:terms.introTitle2,Url:widgetPath+"config/"+s+"/welcome-2.html"},{TopicId:3,Title:terms.introTitle3,Url:widgetPath+"config/"+s+"/welcome-3.html"},{TopicId:3,Title:terms.introTitle4,Url:widgetPath+"config/"+s+"/welcome-4.html"}]}],defaultData=configData,parent.window.postMessage(JSON.stringify({subject:"setFrameTitle",message:{title:terms.title}}),"*"),parent.window.postMessage(JSON.stringify({subject:"getRoleDefinitions",message:""}),"*");break;case"doneGetConfig":break;case"doneAppendHTML":switch(t.message.id){case"buildDependencies":buildModal();break;case"buildModal":addButtonEvents(),welcomeInit()}break;case"eventFired":switch(t.message.id){case"step-back":stepBack();break;case"step-forward":stepForward();break;case"step-dismiss":parent.window.postMessage(JSON.stringify({subject:"changeVisibility",message:{state:"hide",selector:"#welcomeModal",focus:!0,interval:250}}),"*"),parent.window.postMessage(JSON.stringify({subject:"changeVisibility",message:{state:"hide",selector:"#welcomeModalBg",focus:!1,interval:250}}),"*"),parent.window.postMessage(JSON.stringify({subject:"setHTML",message:{htmlString:"",selector:"#welcomeModal .content"}}),"*");break;case"close-modal-welcome":parent.window.postMessage(JSON.stringify({subject:"changeVisibility",message:{state:"hideNoDismiss",focus:!1,selector:"#welcomeModal",interval:250}}),"*"),parent.window.postMessage(JSON.stringify({subject:"changeVisibility",message:{state:"hide",focus:!1,selector:"#welcomeModalBg",interval:250}}),"*"),parent.window.postMessage(JSON.stringify({subject:"setHTML",message:{htmlString:"",selector:"#welcomeModal .content"}}),"*")}break;case"doneVisibilityChange":"#welcomeModal"===t.message.selector&&("hide"===t.message.state||"hideNoDismiss"===t.message.state?("hide"===t.message.state&&welcomeClose(),parent.window.postMessage(JSON.stringify({subject:"removeClass",message:{className:"d2l-dialog-open",selector:"html"}}),"*")):parent.window.postMessage(JSON.stringify({subject:"addClass",message:{className:"d2l-dialog-open",selector:"html"}}),"*"));break;case"doneValenceRequest":if(!t.message.dataArgument.ignoreWidget)switch(t.message.route){case"getMyWidgetData":processMyWidgetData(t.message.data);break;case"getWidgetDataConfigOrg":try{configData=JSON.parse(t.message.data.Data)}catch(e){}gotSharedConfig=!0,getConfig();break;case"getWidgetDataConfig":try{configData=JSON.parse(t.message.data.Data)}catch(e){}$("#launch_welcome_btn").html(configData.buttonText).hide(),void 0!==configData.accentColor&&($(".btn-primary").css({"background-color":configData.accentColor}),$(".btn-primary").css({"border-color":configData.accentColor}),$(".btn-primary").hover((function(){var e=tinycolor(configData.accentColor).darken(5).toString();$(this).css({"background-color":e}),$(this).css({"border-color":e}),$(".btn-primary").css("color",checkFontContrast(e))}),(function(){$(this).css({"background-color":configData.accentColor}),$(this).css({"border-color":configData.accentColor}),$(".btn-primary").css("color",checkFontContrast(tinycolor(configData.accentColor).toHexString()))})),$(".btn-primary").css("color",checkFontContrast(tinycolor(configData.accentColor).toHexString()))),""!==configData.introText&&void 0!==configData.introText||(configData.introText=defaultData.introText),$("#intro").html(configData.introText),""!==configData.moduleTitle&&void 0!==configData.moduleTitle||(configData.moduleTitle=defaultData.moduleTitle),""!==configData.background&&void 0!==configData.background||(configData.background=defaultData.background),""===configData.showDefaultContent||void 0===configData.showDefaultContent?configData.showDefaultContent=defaultData.showDefaultContent:configData.showDefaultContent=jsonValueToBoolean(configData.showDefaultContent,defaultData.showDefaultContent),""===configData.forceDismiss||void 0===configData.forceDismiss?configData.forceDismiss=defaultData.forceDismiss:configData.forceDismiss=jsonValueToBoolean(configData.forceDismiss,defaultData.forceDismiss),$("#welcomeContent").show(),resizeFrame(),parent.window.postMessage(JSON.stringify({subject:"doValenceRequest",message:{route:"getMyWidgetData",data:{}}}),"*");break;case"updateMyWidgetData":break;case"getTOC":tocObj=t.message.data,buildDependencies()}}}function checkFontContrast(e){return tinycolor.mostReadable(e,["#000000","#565A5C","#FFFFFF"],{includeFallbackColors:!0,level:"AAA",size:"small"}).toHexString()}function jsonValueToBoolean(e,t){let s=t;try{!0===e?s=!0:!1===e?s=!1:"true"===e.toLowerCase()?s=!0:"false"===e.toLowerCase()&&(s=!1)}catch(e){s=t}return s}widgetObserver.observe(bodyEl);