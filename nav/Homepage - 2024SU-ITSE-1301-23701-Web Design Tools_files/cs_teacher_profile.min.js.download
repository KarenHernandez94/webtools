var widget,roleDefs,formData,profileEditorData,formDataBeforeEdit,configData,configDataPath,langTerms,defaultConfigData,widgetName="teacher_profile",widgetPath=widgethost+"/widgets/"+widgetName+"/"+v+"/",imgChanged=!1,useDefaultImage=!1,croppieSetupComplete=!1,editorSetupComplete=!1,uploadCrop={},supportedLangs=["en-us","fr-ca","es-mx","pt-br"],canEdit=!1;let retries=0;const maxRetries=10,maxCharacters=32,maxCharactersTextArea=240;function replaceDisplayedLangTerms(){$("[data-lang-term]").each((function(){var e,a,t;e=this,a=langTerms[$(this).data("langTerm")],"button"===(t=this.nodeName.toLowerCase())||"button"===$(e).attr("role")?$(e).attr("aria-label",a).attr("title",a):"img"===t?$(e).attr("alt",a):$(e).text(a),$(this).removeAttr("data-lang-term")})),$(".btn.btn-default.dropdown-toggle.nav-tools").attr("title",langTerms.editorCustomizeWidget),$(".role-heading-container label").append(`<span class="sr-only">${langTerms.maxCharacters.replace("{number}",32)}</span>`),$(".teacher-name-container label").append(`<span class="sr-only">${langTerms.maxCharacters.replace("{number}",32)}</span>`)}function resizeIframe(){var e=$("div.teacher_profile").outerHeight(!0)+"px";parent.window.postMessage(JSON.stringify({subject:"frameResize",message:e}),"*")}function getLanguagePack(){parent.window.postMessage(JSON.stringify({subject:"getLangTerms",message:""}),"*")}function processRoleDefs(e){!0===canEdit&&($(".nav-section").show().css("display","inline-block"),$(".edit-button").on("click",(function(){return showEditorMode(),resizeIframe(),formDataBeforeEdit=profileEditorData,updateFormData(),!1})),$(".save-button").on("click",(function(){showLoadingOverlay(),updateFormData(!0)})),$(".cancel-button").on("click",(function(){hideEditorMode(),$(".form-data").each((function(){$(this).val(formDataBeforeEdit[$(this).attr("data-schemaid")])})),changeBackgroundColor(tinycolor(formDataBeforeEdit["background-color"])),setProfileImage(formDataBeforeEdit.filename),$("#image-upload").val("")})),$(".remove-image").on("click",(function(){removeProfileImage()})))}function updateFormData(e){var a={},t=defaultConfigData["background-color"];$(".form-data").each((function(){var o=$(this).val(),r=$(this).attr("data-schemaid");if(a[r]=o,""===o.trim()?("twitter"!==r&&"facebook"!==r||!e||($(this).closest(".form-thing").next().hide(),$("."+r).hide()),"teacher-name"===r&&$(".profile-image").addClass("reduce-top"),"bio"===r&&o.replace(" ",/&nbsp;/g).replace("&#13;&#10;",/<br.*?>/g)):("teacher-name"===r&&$(".profile-image").removeClass("reduce-top"),"twitter"!==r&&"facebook"!==r||($(this).closest(".form-thing").next().show(),$("."+r).show()),"twitter"===r&&$(".twitter-link").attr("href",o),"facebook"===r&&$(".facebook-link").attr("href",o),"background-color"===r&&(changeBackgroundColor(tinycolor(o)),t=o),"bio"===r&&(o=o.replace("\r\n","N"))),e){let e=$('div[data-schemaid="'+r+'"]');widget.replaceBioUrls&&"bio"===r?(o=replaceUrls(o),e.html(o)):e.text(o)}}));var o=$(".profile-image").css("background-image");void 0===o&&(o=$(".profile-image").attr("style").replace("background-image: ","").replace("\\",""));var r=(o=o.replace(/^url\(['"]?/,"").replace(/['"]?\)$/,"")).indexOf("?");-1!==r&&(o=o.substring(0,r));var i=o.indexOf('"');if(-1!==i&&(o=o.substring(0,i)),a.filename=o,a["background-color"]=t,e){imgChanged&&useDefaultImage?a.filename=defaultConfigData.filename:imgChanged&&(a.filename="new file");var s=a;compareJson(profileEditorData,s)?hideEditorMode():(profileEditorData=s,checkColorInputs(),checkImageInputs(),processForm())}}function showEditorMode(){editorSetupComplete||setUpEditor(),$("textarea, input").each((function(){processCharCount(this)})),$("input").removeAttr("disabled"),$("textarea").removeAttr("disabled"),$(".social-media-links").find(".primary-sm").removeClass("horizontal-flex"),$(".facebook").show().addClass("edit-mode"),$(".twitter").show().addClass("edit-mode"),$(".top-accent-bg").addClass("edit-mode"),$(".top-accent-color").addClass("edit-mode"),$(".profile-image").addClass("edit-mode"),$(".editor-only").show(),$(".editor-only:not(.counter)").attr("aria-hidden","false"),$(".static-only").hide().attr("aria-hidden","true"),$(".form-thing").show()}function hideEditorMode(){$("textarea").attr("disabled",""),$("input").attr("disabled",""),$(".social-media-links").find(".primary-sm").addClass("horizontal-flex"),$(".facebook").removeClass("edit-mode"),$(".twitter").removeClass("edit-mode"),$(".top-accent-bg").removeClass("edit-mode"),$(".top-accent-color").removeClass("edit-mode"),$(".profile-image").removeClass("edit-mode"),$(".editor-only").hide().attr("aria-hidden","true"),$(".static-only").show().attr("aria-hidden","false"),imgChanged=!1,useDefaultImage=!1,hideCroppie(),hideLoadingOverlay()}function processCourseConfig(e,a){defaultConfigData={bio:langTerms.bio,"bio-label":langTerms.bioLabel,facebook:"http://facebook.com/",filename:widgetPath+"img/default.png","role-header":langTerms.roleHeader,"teacher-name":langTerms.teacherName,twitter:"https://twitter.com/","background-color":"#275C36"},configData=e?a:defaultConfigData,buildForm(),populateDisplayedFormData(),replaceDisplayedLangTerms(),hideLoadingOverlay()}function getConfigData(){parent.window.postMessage(JSON.stringify({subject:"getConfig",message:configDataPath,noCache:!0}),"*")}function populateDisplayedFormData(){var e=configData;for(var a in e)if(e.hasOwnProperty(a)){var t=$('.form-data[data-schemaid="'+a+'"]');if(""===e[a].trim()?("twitter"!==a&&"facebook"!==a||(t.closest(".form-thing").next().hide(),$("."+a).hide()),"teacher-name"===a&&$(".profile-image").addClass("reduce-top")):("teacher-name"===a&&$(".profile-image").removeClass("reduce-top"),"twitter"===a&&$(".twitter-link").attr("href",e[a]),"facebook"===a&&$(".facebook-link").attr("href",e[a]),"background-color"===a&&changeBackgroundColor(tinycolor(e[a]))),t.val(e[a]),"bio"===a&&widget.replaceBioUrls){let t=replaceUrls(e[a]);$('div[data-schemaid="'+a+'"]').html(t)}else $('div[data-schemaid="'+a+'"]').text(e[a]);$("."+a+"-counter").find(".current").text(e[a].length)}$("#role-header").attr("aria-label",langTerms.headingText),$("#teacher-name").attr("aria-label",langTerms.displayName),$("#image-upload").attr("aria-label",langTerms.uploadImage),$("#bio-label").attr("aria-label",`${langTerms.bioLabelAriaLabel} ${langTerms.maxCharacters.replace("{number}",32)}`),$("#bio-area").attr("aria-label",`${langTerms.bioAriaLabel} ${langTerms.maxCharacters.replace("{number}",240)}`),$("#facebook-input").attr("aria-label",langTerms.facebook),$("#twitter-input").attr("aria-label",langTerms.twitter)}function hideLoadingOverlay(){$(".loader-wrapper").fadeOut((function(){$(".container-fluid.hideme").hide().removeClass("hideme").fadeIn(),resizeIframe()}))}function showLoadingOverlay(){$(".loader-wrapper").fadeIn()}function textAreaAdjust(e){e.style.height="1px",e.style.height=10+e.scrollHeight+"px",resizeIframe()}function processCharCount(e){/iPhone|iPad/i.test(navigator.userAgent)&&$(e).val($(e).val().replace(/(?:\r\n|\r|\n)/g,"\n"));var a=$(e).val().length,t=$($(e).siblings(".counter")[0]),o=t.find(".current"),r=(t.find(".maximum"),$(e).attr("maxlength"));o.text(a);var i=a/r;i<.3&&(i=.3);var s=$(e).parent().find(".counter");if(a>=r){$(s).css("background-color","#FFBA59"),$(s).css("border-radius","14px"),$(s).addClass("badge"),$(s).addClass("badge-warning");var n=tinycolor.mostReadable("#FFBA59",["#000000","#FFFFFF"],{includeFallbackColors:!0,level:"AA",size:"small"}).toHexString();$(s).css("color",n),t.css("font-weight","bold")}else{var l=$(s).parent().find("label").css("color");t.css("font-weight","normal"),$(s).css("color",l),$(s).css("background-color","unset")}}function changeBackgroundColor(e){$(".top-accent-color").css("background-color",e),$(".animate-colors").removeClass("animate-colors"),$("#background-color-input").val(e);var a=tinycolor.mostReadable(e,["#565A5C","#FFFFFF"],{includeFallbackColors:!0,level:"AA",size:"small"}).toHexString();$(".top-accent-bg label").css("color",a),$(".teacher-name").css("color",a),$(".role-header").css("color",a)}function buildForm(){var e=configData;e.hasOwnProperty("filename")?setProfileImage(e.filename):e.filename="",profileEditorData=e}function compareJson(e,a){var t=!0;if(Object.keys(e).length===Object.keys(a).length){for(var o in e)if(e[o]!==a[o]){t=!1;break}}else t=!1;return t}function hideCroppie(){$(".cr-slider-wrap").attr("aria-hidden","true").hide(),$(".cr-boundary").attr("aria-hidden","true").hide()}function showCroppie(e){$(".cr-slider-wrap").attr("aria-hidden","false").show(),$(".cr-boundary").attr("aria-hidden","false").show(0,(function(){uploadCrop.croppie("bind",{url:e})}))}function setProfileImage(e){var a=(new Date).getTime();$(".profile-image").css("background-image","url('"+e+"?v="+a+"')")}function removeProfileImage(){setProfileImage(defaultConfigData.filename),$("#image-upload").val(""),hideCroppie(),imgChanged=!0,useDefaultImage=!0}function setUpEditor(){$("textarea, input").keyup((function(){processCharCount(this)})),$(document).on("change","#image-upload",(function(){readFile(this)})),editorSetupComplete=!0}function setUpCroppie(e,a){uploadCrop=e.croppie({enableExif:!0,viewport:{width:150,height:150,type:"circle"}}),e.find(".cr-boundary").css({height:"150px",width:"150px"}),e.find(".cr-viewport").css({height:"150px",width:"150px"}),e.find(".mobile-view .cr-boundary").css({height:"150px"}),e.find(".mobile-view .cr-viewport").css({height:"150px",width:"150px"}),e.find(".cr-slider").attr("step","0.01"),uploadCrop.croppie("bind",{url:a}).then((function(){croppieSetupComplete=!0}))}function readFile(e){if(e.files&&e.files[0]){var a=new FileReader;a.onload=function(e){var a=e.target.result;imgChanged=!0,useDefaultImage=!1,$(".profile-image").css("background-image","none"),croppieSetupComplete?showCroppie(a):setUpCroppie($("div.profile-image"),a)},a.readAsDataURL(e.files[0])}else console.log("Sorry, your browser doesn't support the FileReader API.")}function uploadConfigData(e){formData=profileEditorData,void 0!==e&&(formData.filename=e);var a={template:"uploadCourseContent",filedata:JSON.stringify(formData),filename:"config.txt",isImage:!1};parent.window.postMessage(JSON.stringify({subject:"doValenceRequest",message:{route:"uploadFile",data:a}}),"*")}function uploadProfileImage(){var e=!1;uploadCrop.croppie("result",{type:"base64",circle:!1}).then((function(a){if(e=a){var t={template:"uploadCourseContent",filedata:e,filename:Date.now()+"_TP_IMG.png",isImage:!0};parent.window.postMessage(JSON.stringify({subject:"doValenceRequest",message:{route:"uploadFile",data:t}}),"*")}}))}function processForm(){imgChanged&&!useDefaultImage?uploadProfileImage():uploadConfigData()}function checkColorInputs(){$.each($('input[type="color"]'),(function(){!1===$(this).hasClass("spectrum-color")&&($(this).addClass("spectrum-color"),$(this).spectrum({preferredFormat:"hex",showInput:!0}))}))}function checkImageInputs(){$.each($('[data-schemaid="file_upload"]'),(function(e){!1===$(this).hasClass("desc-added")&&(this.id=e,$(this).addClass("desc-added"))}))}function removeBottomBorderRadius(e){$(e).addClass("no-bottom-border-radius")}function resetBottomBorderRadius(e){$(e).removeClass("no-bottom-border-radius")}function adjustColorPickerPosition(e){$(".sp-container").css("top",parseInt($(".sp-container").css("top"))+e+"px")}function addKeyboardControlsToColorPicker(e){$(".sp-thumb-el").attr("tabindex","0"),$(".sp-thumb-el").on("focus",(function(){$(".recolor-button").spectrum("set",$(this).attr("title"))}))}function events(e){var a=JSON.parse(e.data);switch(a.subject){case"doneGetLangTerms":null!=a.message.bio&&(langTerms=a.message),recolorInit(),parent.window.postMessage(JSON.stringify({subject:"getRoleDefinitions",message:""}),"*"),parent.window.postMessage(JSON.stringify({subject:"setFrameTitle",message:{title:langTerms.title}}),"*");break;case"doneGetReplaceStrings":widget=a.message,canEdit=JSON.parse(atob(a.message.session).split("-").pop().toLowerCase()),"boolean"!=typeof widget.replaceBioUrls&&(widget.replaceBioUrls=!0),configDataPath=widget.instance.domain+widget.orgUnit.path+"custom_widgets/teacher_profile/config.txt",getLanguagePack();break;case"doneGetRoleDefinitions":processRoleDefs(roleDefs=a.message),getConfigData();break;case"doneGetConfig":processCourseConfig(a.message.success,a.message.data);break;case"doneValenceRequest":switch(a.message.route){case"uploadFile":if(a.message.dataArgument.isImage){var t=widget.instance.domain+widget.orgUnit.path+"custom_widgets/teacher_profile/img/"+a.message.data.filename;setProfileImage(decodeString(t)),uploadConfigData(decodeString(t))}else hideEditorMode()}break;case"retryGetConfig":retries<=10&&(retries++,getConfigData())}}function focusOnPicker(){$('a, area, button, input, object, select, textarea, [tabindex="0"]').not('.recolor-button, .sp-thumb-el, .sp-palette-toggle, .sp-choose, #image-upload, .sp-input, [aria-hidden="true"]').addClass("untabbable").attr("tabindex","-1")}function unfocusOnPicker(){$(".untabbable").attr("tabindex","0").removeClass("untabbable"),$("button.recolor-button")[0].focus()}function replaceUrls(e){return e.replace(/(https?:\/\/)([^ \n])+([^ \n\.,?!)])/gi,(function(e){return'<a href="'+e+'" target="_blank">'+e+"</a>"}))}function decodeString(e){var a=document.createElement("textarea");return a.innerHTML=e,a.value}function recolorInit(){$(".recolor-button").spectrum({color:"#275C36",showButtons:!0,showPalette:!0,showInput:!0,showInitial:!0,preferredFormat:"name",togglePaletteMoreText:"More",togglePaletteLessText:"Less",togglePaletteOnly:!0,showSelectionPalette:!1,paletteTabIndex:!0,chooseText:langTerms.close,appendTo:".picker-modal",show:function(){adjustColorPickerPosition(-6),removeBottomBorderRadius(this),focusOnPicker()},hide:function(){resetBottomBorderRadius(this),unfocusOnPicker()},move:function(e){changeBackgroundColor(e)},palette:[["#BBF1FA","#E8F2F9","#E9E6FF","#F6E1FA","#FAE1ED","#FAE1E2","#FAE3CF","#FAE5C8","#FFFBB2","#CDF2B1","#A5FABD","#A1F7F4"],["#00BDDD","#29A6FF","#AFA1FF","#EA82FF","#FF389B","#FF6B70","#E87511","#FFBA59","#F5EC5A","#8CCD5A","#46A661","#00AFAA"],["#00849C","#006FBF","#7862F0","#B24AC7","#BF2A75","#CD2026","#A6540D","#A87B3B","#A69F21","#59823A","#327846","#017D79"],["#005B6B","#005694","#4C3F99","#7E358C","#96215C","#A1191D","#804008","#694B25","#635F15","#3D5926","#275C36","#005E5B"]]})}$((function(){var e;$(".loader-wrapper").append('<div class="d2l-loading-spinner"><div class="d2l-loading-spinner-wrapper"><svg viewBox="0 0 42 42" class="d2l-loading-spinner-bg-blur" focusable="false"><g fill="none" fill-rule="evenodd" transform="translate(5 5)"><circle stroke="none" fill="#000" cx="16" cy="16" r="14"></circle></g></svg><svg viewBox="0 0 42 42" class="d2l-loading-spinner-bg" focusable="false"><g fill="none" fill-rule="evenodd" transform="translate(5 5)"><circle stroke-width="0.5" cx="16" cy="16" r="16" class="d2l-loading-spinner-bg-stroke"></circle><circle stroke="none" fill="#FFF" cx="16" cy="16" r="16"></circle><circle stroke-width="2" cx="16" cy="16" r="11"></circle></g></svg><svg viewBox="0 0 42 42" class="d2l-loading-spinner-slice1" focusable="false"><g fill="none" fill-rule="evenodd"><path d="M24 42h8c0-17.673-14.327-32-32-32v8c1.105 0 2 .895 2 2s-.895 2-2 2v20h20c0-1.105.895-2 2-2s2 .895 2 2z" fill="#FFF"></path><path d="M0 22c1.105 0 2-.895 2-2s-.895-2-2-2c13.255 0 24 10.745 24 24 0-1.105-.895-2-2-2s-2 .895-2 2c0-11.046-8.954-20-20-20z" fill="#E6EAF0"></path></g></svg><svg viewBox="0 0 42 42" class="d2l-loading-spinner-slice2" focusable="false"><g fill="none" fill-rule="evenodd"><path d="M24 42h8c0-17.673-14.327-32-32-32v8c1.105 0 2 .895 2 2s-.895 2-2 2v20h20c0-1.105.895-2 2-2s2 .895 2 2z" fill="#FFF"></path><path d="M0 22c1.105 0 2-.895 2-2s-.895-2-2-2c13.255 0 24 10.745 24 24 0-1.105-.895-2-2-2s-2 .895-2 2c0-11.046-8.954-20-20-20z" fill="#E6EAF0"></path></g></svg><svg viewBox="0 0 42 42" class="d2l-loading-spinner-slice3" focusable="false"><g fill="none" fill-rule="evenodd"><path d="M24 42h8c0-17.673-14.327-32-32-32v8c1.105 0 2 .895 2 2s-.895 2-2 2v20h20c0-1.105.895-2 2-2s2 .895 2 2z" fill="#FFF"></path><path d="M0 22c1.105 0 2-.895 2-2s-.895-2-2-2c13.255 0 24 10.745 24 24 0-1.105-.895-2-2-2s-2 .895-2 2c0-11.046-8.954-20-20-20z" fill="#E6EAF0"></path></g></svg><svg viewBox="0 0 42 42" class="d2l-loading-spinner-slice4" focusable="false"><g fill="none" fill-rule="evenodd"><path d="M24 42h8c0-17.673-14.327-32-32-32v8c1.105 0 2 .895 2 2s-.895 2-2 2v20h20c0-1.105.895-2 2-2s2 .895 2 2z" fill="#FFF"></path><path d="M0 22c1.105 0 2-.895 2-2s-.895-2-2-2c13.255 0 24 10.745 24 24 0-1.105-.895-2-2-2s-2 .895-2 2c0-11.046-8.954-20-20-20z" fill="#E6EAF0"></path></g></svg><svg viewBox="0 0 42 42" class="d2l-loading-spinner-slice5" focusable="false"><g fill="none" fill-rule="evenodd"><path d="M24 42h8c0-17.673-14.327-32-32-32v8c1.105 0 2 .895 2 2s-.895 2-2 2v20h20c0-1.105.895-2 2-2s2 .895 2 2z" fill="#FFF"></path><path d="M0 22c1.105 0 2-.895 2-2s-.895-2-2-2c13.255 0 24 10.745 24 24 0-1.105-.895-2-2-2s-2 .895-2 2c0-11.046-8.954-20-20-20z" fill="#E6EAF0"></path></g></svg></div></div>'),$(".editor-only").hide().attr("aria-hidden","true"),window.addEventListener("message",events,!1),parent.window.postMessage(JSON.stringify({subject:"getLang",message:""}),"*"),parent.window.postMessage(JSON.stringify({subject:"getReplaceStrings",message:""}),"*"),$(document).on("keypress",".sp-thumb-el",(function(e){13!==e.which&&32!==e.which||(changeBackgroundColor(tinycolor($(this).attr("title"))),$(".recolor-button").spectrum("set",$(this).attr("title")),$(this).focus())})),$(document).on("keypress",".sp-input",(function(e){13===e.which&&(changeBackgroundColor(tinycolor($(this).val())),$(".recolor-button").spectrum("set",$(this).val()))})),$(document).on("keyup",".image-upload-label",(function(e){13===e.keyCode&&$(this).click()})),$(window).on("resize",(function(){clearTimeout(e),e=setTimeout(resizeIframe,500)}))}));