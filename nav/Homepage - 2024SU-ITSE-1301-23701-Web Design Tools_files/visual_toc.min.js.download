var configDataPath,sharedConfigPath,coloredBar,flip,displayProgress,resizeId,courseImage,widget={},roleDefs={},toc={},widgetPath=widgethost+"/widgets/visual_toc/"+v+"/",timestamp=(new Date).getTime(),mainConfigPath=widgetPath+"config/config.txt?v="+timestamp,imagePath=widgetPath+"img/",widgetData={},sharedConfigLoaded=!1,courseConfigLoaded=!1,pageturning=!1,updatedModules=0,totalModules=0,terms={title:"Visual Table of Contents",GotoModule:"Go to Module",Description:"Description",ShowDescription:"Show Description",Continue:"Continue",ModuleComplete:"Complete",FirstTopic:"First Topic: {topic}",NextTopic:"Next Topic: {topic}",Begin:"Begin {module}",Complete:"{percent}% Complete",TopicsCompleted:"{read} of {total} Topics Completed"},modcallsdone=0,modcallstotal=0,completionCalculated=!1,topicCompletionCalculated=!1,tocCompletion={},paging=!1,defaultTermsLoaded=!1,tilesBuilt=!1,forceTopLevelModuleNav=!1,radialProgress=!1,completionProgress=!1,ignoreModuleString="***",accenthex="#006fbf",headerhex="#1870C2",defaultImage="tile-img-default-shared.jpeg",barColors={0:"#006FBF",25:"#006FBF",50:"#006FBF",75:"#006FBF"},options={size:120,lineWidth:10,rotate:0};function init(){parent.window.postMessage(JSON.stringify({subject:"doValenceRequest",message:{route:"getCourseImage",data:{queryParams:{height:192,width:768}}}}),"*"),parent.window.postMessage(JSON.stringify({subject:"getReplaceStrings",message:""}),"*")}function getConfigData(){fetch(mainConfigPath).then((function(e){return e.json()})).then((function(e){var t=e.Configuration;paging=!0===t.usePaging,coloredBar=void 0!==t.coloredBar&&t.coloredBar,flip=void 0===t.flip||t.flip,displayProgress=void 0===t.displayProgress||t.displayProgress,usingCustomLangTerms=void 0!==t.useCustomLangTerms&&t.useCustomLangTerms,forceTopLevelModuleNav=void 0!==t.forceTopLevelModuleNav&&t.forceTopLevelModuleNav})).catch((function(){console.log("Unable to locate main configuration file at "+mainConfigPath)})).finally((function(){parent.window.postMessage(JSON.stringify({subject:"getRoleDefinitions",message:""}),"*"),parent.window.postMessage(JSON.stringify({subject:"doValenceRequest",message:{route:"getWidgetDataConfigOrg",data:{}}}),"*")}))}function processSharedConfig(e,t){if(!0===e){var i=t.Configuration;paging=!0===i.usePaging,coloredBar=void 0!==i.coloredBar&&i.coloredBar,flip=void 0===i.flip||i.flip,displayProgress=void 0===i.displayProgress||i.displayProgress,forceTopLevelModuleNav=void 0!==i.forceTopLevelModuleNav&&i.forceTopLevelModuleNav,isHexaColor(i.AccentHexCode)&&(accenthex=i.AccentHexCode),isHexaColor(i.HeaderHexCode)&&(headerhex=i.HeaderHexCode),""!==i.DefaultTileImage&&void 0!==i.DefaultTileImage&&"tile-img-default-shared.jpeg"!==i.DefaultTileImage&&(defaultImage=i.DefaultTileImage,imagePath=widget.instance.domain+"/shared/custom_widgets/visual_toc/img/"),""!==i.IgnoreModuleString&&(ignoreModuleString=i.IgnoreModuleString),void 0!==i.BarColors&&(barColors=i.BarColors)}sharedConfigLoaded=!0}function processCourseConfig(e,t){if(!0===e){var i=t.Configuration;paging=!0===i.usePaging,coloredBar=void 0!==i.coloredBar&&i.coloredBar,flip=void 0===i.flip||i.flip,displayProgress=void 0===i.displayProgress||i.displayProgress,forceTopLevelModuleNav=void 0!==i.forceTopLevelModuleNav&&i.forceTopLevelModuleNav,isHexaColor(i.AccentHexCode)&&(accenthex=i.AccentHexCode),isHexaColor(i.HeaderHexCode)&&(headerhex=i.HeaderHexCode),""!==i.DefaultTileImage&&void 0!==i.DefaultTileImage&&"tile-img-default-shared.jpeg"!==i.DefaultTileImage&&(defaultImage=i.DefaultTileImage,imagePath=`${widget.instance.domain}${widget.orgUnit.path}custom_widgets/visual_toc/img/`),""!==i.IgnoreModuleString&&(ignoreModuleString=i.IgnoreModuleString),void 0!==i.BarColors&&(barColors=i.BarColors)}else console.log("No course configuration found at "+configDataPath);courseConfigLoaded=!0}function processRoot(){topicCompletionCalculated=!0,completionCalculated=!0,tileInit()}function processModule(e,t){if(e.Progress={Read:0,Total:0,Percentage:0},void 0!==e.Modules)for(var i=0;i<e.Modules.length;i++)e.Modules[i]=processModule(e.Modules[i]),e.Progress.Total+=e.Modules[i].Progress.Total,e.Progress.Read+=e.Modules[i].Progress.Read;else e.Modules=[];if(void 0!==e.Topics)for(var a=0;a<e.Topics.length;a++)!1===e.Topics[a].IsBroken&&3!==e.Topics[a].CompletionType&&(e.Progress.Total++,!1===e.Topics[a].Unread&&e.Progress.Read++,"Link"===e.Topics[a].TypeIdentifier&&"/d2l"===e.Topics[a].Url.substr(0,4)?(e.Topics[a].Url.indexOf("&type=discuss&")>-1?e.Topics[a].Type="Discussion":e.Topics[a].Url.indexOf("&type=dropbox&")>-1?e.Topics[a].Type="Dropbox":e.Topics[a].Url.indexOf("&type=quiz&")>-1?e.Topics[a].Type="Quiz":e.Topics[a].Url.indexOf("&type=checklist&")>-1?e.Topics[a].Type="Checklist":e.Topics[a].Url.indexOf("&type=selfassess&")>-1?e.Topics[a].Type="SelfAssessment":e.Topics[a].Url.indexOf("&type=survey&")>-1&&(e.Topics[a].Type="Survey"),e.Topics[a].Source="Internal"):"Link"===e.Topics[a].TypeIdentifier?(e.Topics[a].Type=e.Topics[a].Url.substr(2+(~-e.Topics[a].Url.lastIndexOf(".")>>>0)),e.Topics[a].Source="External"):"File"===e.Topics[a].TypeIdentifier?null!==e.Topics[a].Url&&(e.Topics[a].Type=e.Topics[a].Url.substr(2+(~-e.Topics[a].Url.lastIndexOf(".")>>>0)),e.Topics[a].Source="Internal"):(e.Topics[a].Type="unknown",e.Topics[a].Source="unknown")),e.Topics[a].ParentModuleId=e.ModuleId,e.Topics[a].ParentModuleTitle=e.Title;else e.Topics=[];return e.Progress.Percentage=0===e.Progress.Total?0:e.Progress.Read/e.Progress.Total*100,e}function updateModule(e){var t=document.querySelector('[data-ouid="'+e.ModuleId+'"]');if(e.Progress.Total&&!0===displayProgress){var i=t.querySelector(".progress-container"),a=Math.round(e.Progress.Percentage),o=accenthex;if(coloredBar)for(var n=Object.keys(barColors),r=0;r<n.length;++r)a>=n[r]&&(o=barColors[n[r]]);var s=document.createElement("div");s.classList.add("progress");var d=document.createElement("div");d.setAttribute("role","progressbar"),d.setAttribute("aria-valuenow",a),d.setAttribute("aria-valuemin","0"),d.setAttribute("aria-valuemax","100"),d.setAttribute("style","width: "+a+"%; background-color: "+o+";"),d.classList.add("progress-bar");var l=document.createElement("span");l.classList.add("sr-only"),l.innerText=terms.Complete.replace("{percent}",a),d.appendChild(l),s.appendChild(d);var c=document.createElement("p");c.classList.add("subtopic"),c.innerHTML="<span>"+a+'%</span><span class="subtopic">'+terms.TopicsCompleted.replace("{read}",e.Progress.Read).replace("{total}",e.Progress.Total)+"</span>",i.appendChild(s),i.appendChild(c)}var u,p=findFirstTopic(e),g=t.querySelector(".headerarea").lastChild,m=t.querySelector(".quicknav"),f=findNextUnread(e);if(f&&!1===forceTopLevelModuleNav&&(g.href=widget.instance.domain+"/d2l/le/content/"+widget.orgUnit.id+"/Home?itemIdentifier=D2L.LE.Content.ContentObject.ModuleCO-"+f.ParentModuleId,g.title=terms.Begin.replace("{module}",f.ParentModuleTitle)),f?(void 0!==f&&!1===f.IsBroken&&((u=document.createElement("a")).href=widget.instance.domain+"/d2l/le/content/"+widget.orgUnit.id+"/viewContent/"+f.Identifier+"/View",u.target="_top",u.classList.add("continue","blue"),u.innerHTML='<div class="continueImg"><div></div></div>',0===e.Progress.Read?u.title=terms.FirstTopic.replace("{topic}",f.Title):u.title=terms.NextTopic.replace("{topic}",f.Title),m.appendChild(u)),t.classList.add("unread")):100===a?((u=document.createElement("div")).classList.add("continue"),u.setAttribute("aria-label",terms.ModuleComplete),u.setAttribute("tab-index","-1"),u.innerHTML='<div class="checkmark"><div></div></div>',m.appendChild(u)):p&&void 0!==p&&!1===p.IsBroken&&((u=document.createElement("a")).href=widget.instance.domain+"/d2l/le/content/"+widget.orgUnit.id+"/viewContent/"+p.Identifier+"/View",u.target="_top",u.classList.add("continue","blue"),u.innerHTML='<div class="continueImg"><div></div></div>',u.title=0===a?terms.FirstTopic.replace("{topic}",p.Title):terms.NextTopic.replace("{topic}",p.Title),m.appendChild(u)),++updatedModules===totalModules){var v=$(".unread")[0];setUsersCurrentModule($(v).index())}}function isHexaColor(e){return"string"==typeof(e=e.replace("#",""))&&6===e.length&&!isNaN(parseInt(e,16))}function resizeFrame(){parent.window.postMessage(JSON.stringify({subject:"frameResize",message:$("body").outerHeight()+10+"px"}),"*")}var mql=window.matchMedia("(min-width: 300px) and (max-width: 699px)"),mql1=window.matchMedia("(max-width: 700px)"),mql2=window.matchMedia("(min-width: 801px) and (max-width: 1047px)"),mql3=window.matchMedia("(min-width: 1048px)"),numOfItemsInRow=4;function screenTest(e){e.matches?$(".alltiles").addClass("goMobile"):$(".alltiles").removeClass("goMobile"),setTimeout((function(){checkPaging()}),500)}function screenTest1(){setTimeout((function(){checkPaging()}),500)}function screenTest2(e){e.matches&&setTimeout((function(){checkPaging()}),500)}function screenTest3(e){e.matches&&setTimeout((function(){checkPaging()}),500)}paging&&(mql.addListener(screenTest),mql1.addListener(screenTest1),mql2.addListener(screenTest2),mql3.addListener(screenTest3));var currentPageNum=0,numberOfPages=0;numOfItemsInRow=4;function checkPaging(){if(0!==$(".miletile").length&&!1!==paging){var e=$('.miletile[data-pagenum="'+currentPageNum+'"]')[0];numOfItemsInRow=2*$(".alltiles").css("grid-template-columns").split(" ").length,numberOfPages=Math.ceil(Number($(".miletile").length)/Number(numOfItemsInRow)),setPaging(numOfItemsInRow,numberOfPages,e),$(".miletile").removeClass("hidden-opacity")}}function setPaging(e,t,i){$(".miletile").removeClass("visuallyhidden");var a=0,o=-1;$(".miletile").each((function(t){++o>Number(e)-1&&(o=0,a++);var i=$(".miletile")[t];$(i).attr("data-pagenum",a)})),currentPageNum=void 0!==i?Number($(i).attr("data-pagenum")):0,!1===$('.miletile[data-pagenum = "'+currentPageNum+'"]').hasClass("visuallyhidden")&&($(".miletile").addClass("visuallyhidden"),$('.miletile[data-pagenum = "'+currentPageNum+'"]').removeClass("visuallyhidden")),$(".pageNavDropdown").html("");for(var n=0;n<t;n++){var r='<option value="'+(n+1)+'">'+(n+1)+" of "+t+"</option>";$(".pageNavDropdown").append(r),$(".pageNavDropdown").val(currentPageNum+1)}$(".pageNavDropdown").on("change",(function(){currentPageNum=$(".pageNavDropdown :selected").index(),checkPaging(),setNavButton()})),setNavButton();var s=$(".tile-progress").outerHeight()+"px";$(".miletile").not(".visuallyhidden").length<=$(".alltiles").css("grid-template-columns").split(" ").length&&$(".alltiles"),parent.window.postMessage(JSON.stringify({subject:"frameResize",message:s}),"*")}var setNavButton=function(){currentPageNum+1===1?($(".prevPageButton").attr("disabled","disabled"),$(".nextPageButton").removeAttr("disabled","disabled")):currentPageNum+1>=numberOfPages?($(".nextPageButton").attr("disabled","disabled"),$(".prevPageButton").removeAttr("disabled","disabled")):($(".prevPageButton").removeAttr("disabled","disabled"),$(".nextPageButton").removeAttr("disabled","disabled"))},drawCircle=function(e,t,i){var a=(options.size-options.lineWidth)/2,o=i/100,n=$("#"+e+" .progressarea"),r=document.createElement("canvas"),s=document.createElement("span");if(s.textContent=(100*o).toFixed()+"%",void 0!==d){var d={};d.initElement(r)}var l=r.getContext("2d");r.width=r.height=options.size,n.append(s),n.append(r),l.translate(options.size/2,options.size/2),l.rotate((options.rotate/180-.5)*Math.PI),l.beginPath(),l.arc(0,0,a,0,2*Math.PI*1,!1),l.strokeStyle="#e5e5e5",l.lineCap="butt",l.lineWidth=options.lineWidth,l.stroke(),o>0&&(1===o?(o=Math.min(Math.max(0,o||1),1),l.beginPath(),l.arc(0,0,a,0,2*Math.PI*o,!1),l.strokeStyle="#006f53",l.lineCap="butt",l.lineWidth=options.lineWidth,l.stroke()):(o=Math.min(Math.max(0,o||1),1),l.beginPath(),l.arc(0,0,a,0,2*Math.PI*o,!1),l.strokeStyle=accenthex,l.lineCap="butt",l.lineWidth=options.lineWidth,l.stroke()))};function flipClick(e){document.querySelector("#milestone"+e).classList.toggle("flip");var t=$("#milestone"+e).data("flipped");t?($("#milestone"+e+" .back").attr("aria-hidden",!0),$("#milestone"+e+" .flipper .front").attr("aria-hidden",!1),setTimeout((function(){$("#milestone"+e+" .back").attr("tabindex","-1"),$("#milestone"+e+" .back .quicknav .overview").attr("tabindex","-1"),$("#milestone"+e+" .flipper .front").attr("tabindex",0),$("#milestone"+e+" .flipper .front .quicknav .overview").attr("tabindex","0"),$("#milestone"+e+" .flipper .front .quicknav .continue").attr("tabindex","0"),$("#milestone"+e+" .flipper .front .headerarea a").attr("tabindex","0"),$("#milestone"+e+" .flipper .front .quicknav .overview").focus(),$("#milestone"+e+" .flipper .front .quicknav .overview").attr("aria-hidden",!1),$("#milestone"+e+" .back .quicknav .overview").attr("aria-hidden",!0)}),250)):($("#milestone"+e+" .flipper .back .tiledesc").fadeIn(),$("#milestone"+e+" .back").attr("aria-hidden",!1),$("#milestone"+e+" .flipper .front").attr("aria-hidden",!0),setTimeout((function(){$("#milestone"+e+" .flipper .front").attr("tabindex","-1"),$("#milestone"+e+" .flipper .front .quicknav .overview").attr("tabindex","-1"),$("#milestone"+e+" .flipper .front .quicknav .continue").attr("tabindex","-1"),$("#milestone"+e+" .flipper .front .headerarea a").attr("tabindex","-1"),$("#milestone"+e+" .back .quicknav .overview").attr("tabindex","0"),$("#milestone"+e+" .back").attr("tabindex",0),$("#milestone"+e+" .back .quicknav .overview").focus(),$("#milestone"+e+" .back .quicknav .overview").attr("aria-hidden",!1),$("#milestone"+e+" .flipper .front .quicknav .overview").attr("aria-hidden",!0)}),250)),setTimeout((function(){(t=$("#milestone"+e).data("flipped"))?($("#milestone"+e).data("flipped",!1),$("#milestone"+e+" .flipper .tiledesc").css("display","none")):$("#milestone"+e).data("flipped",!0),$("#milestone"+e+".flip canvas").css("display","none"),$("#milestone"+e+'.flip-container:not(".flip") .front canvas').css("display","block")}),100)}function tileInit(){var e;if(!1===tilesBuilt&&completionCalculated&&topicCompletionCalculated){tilesBuilt=!0;var t=function(){this.tileimage=courseImage,document.getElementById("img_"+this.i).setAttribute("style",'background-image: url("'+this.tileimage+'")')},i=function(){document.getElementById("img_"+this.i).setAttribute("style",'background-image: url("'+this.tileimage+'")')};totalModules=toc.Modules.length;for(var a=0;a<toc.Modules.length;a++)if(-1===toc.Modules[a].Title.indexOf(ignoreModuleString)){var o=toc.Modules[a].Description.Html.replace(/src=/g,"data-src="),n=document.createElement("div");n.innerHTML=o;for(var r,s=n.getElementsByTagName("img"),d=null,l=new Image,c=0;c<s.length;c++)if(null!==s[c].getAttribute("data-src")){d=s[c];break}if(null===d||null===d.getAttribute("data-src"))r=`${imagePath}${defaultImage}`,l.src=r,l.i=a,l.tileimage=r;else{var u=(r=d.getAttribute("data-src")).replace(/ /g,"%20");null===u.match(/https?:\/\//gi)?(l.src=widget.instance.domain+u,l.tileimage=widget.instance.domain+u):(l.src=u,l.tileimage=u),l.i=a}l.onerror=t,l.onload=i;var p=document.createElement("div");p.id="milestone"+a,p.classList.add("miletile","flip-container"),p.setAttribute("data-ouid",toc.Modules[a].Id);var g=document.createElement("div");g.classList.add("flipper");var m=document.createElement("div");m.classList.add("front");var f=document.createElement("div");f.classList.add("headerarea");var v=document.createElement("a");v.title=terms.GoToModule+" "+toc.Modules[a].Title,v.href=widget.instance.domain+"/d2l/le/content/"+widget.orgUnit.id+"/Home?itemIdentifier=D2L.LE.Content.ContentObject.ModuleCO-"+toc.Modules[a].Id,v.target="_top";var h=document.createElement("div");h.id="img_"+a,h.classList.add("header-img"),v.appendChild(h);var b=document.createElement("a");b.title=terms.Begin.replace("{module}",toc.Modules[a].Title),b.href=widget.instance.domain+"/d2l/le/content/"+widget.orgUnit.id+"/Home?itemIdentifier=D2L.LE.Content.ContentObject.ModuleCO-"+toc.Modules[a].Id,b.target="_top";var T=document.createElement("h3"),C=toc.Modules[a].Title;C.length>35&&(C=C.substring(0,35),C+="..."),T.innerText=C,b.append(T),f.appendChild(v),f.appendChild(b);var w=document.createElement("div");w.classList.add("progress-container");var M=document.createElement("div");M.classList.add("quicknav"),m.appendChild(f),m.appendChild(w),m.appendChild(M),g.appendChild(m),p.appendChild(g);var P=document.createElement("div");if(P.classList.add("back"),P.setAttribute("aria-hidden","true"),P.setAttribute("aria-labelledby","desc"+a),P.setAttribute("role","dialog"),e=toc.Modules[a].Description.Text.replace(/\s/g,"").replace(/\n/g,"").length,!0===flip&&Number(e)>0){var x=document.createElement("button");x.id="overview_"+a,x.classList.add("overview"),x.setAttribute("type","button"),x.setAttribute("aria-label",terms.ShowDescription),x.onclick=function(e){flipClick(e.target.id.split("_").pop())};var y=document.createElement("div");y.classList.add("overviewImg"),y.innerHTML="<div></div>",x.appendChild(y),M.appendChild(x);var I=toc.Modules[a].Description.Text;toc.Modules[a].Description.Text.length>180&&(I=I.substring(0,180),I+="...");var k=document.createElement("div");k.classList.add("tiledesc"),k.innerHTML='<p><span class="sr-only">'+terms.Description+": </span>"+I+"</p>";var N=document.createElement("div");N.classList.add("quicknav");var L=document.createElement("button");L.id="return_"+a,L.classList.add("overview"),L.setAttribute("role","button"),L.setAttribute("type","button"),L.setAttribute("aria-label",terms.ShowOverview),L.setAttribute("aria-hidden","true"),L.onclick=function(e){flipClick(e.target.id.split("_").pop())};var O=document.createElement("div");O.classList.add("returnImg"),O.innerHTML="<div></div>",L.appendChild(O),N.appendChild(L),P.appendChild(N),P.appendChild(k),p.appendChild(P)}document.getElementsByClassName("alltiles")[0].appendChild(p);var B={queryParams:{moduleId:toc.Modules[a].Id}};parent.window.postMessage(JSON.stringify({subject:"doValenceRequest",message:{route:"getTOC",data:B}}),"*")}else totalModules--;$(".headerarea h3").css("color",headerhex),resizeFrame();var D=2*$(".alltiles").css("grid-template-columns").split(" ").length;if(Math.ceil(Number($(".miletile").length)/Number(D))<=1&&(paging=!1),paging){$(".tile-progress").addClass("paging");var S=`<button class='prevPageButton' aria-label="${terms.PreviousPage}" title="${terms.PreviousPage}"><span class='caret caret-left'></span></button>`,q=`<button class='nextPageButton' aria-label="${terms.NextPage}" title="${terms.NextPage}"><span class='caret caret-right'></span></button>`;$(".tile-progress").append("<div class='navwrapper'></div>"),$(".navwrapper").append(S),$(".navwrapper").append('<div class="btn-group dropup dropNavMenu"><select class="pageNavDropdown" name="dropDownNavigation" title="page results"></select></div>'),$(".navwrapper").append(q),$(".prevPageButton").click((function(){--currentPageNum<=0&&(currentPageNum=0,$(this).attr("disabled","disabled")),$(".nextPageButton").removeAttr("disabled","disabled"),checkPaging()})),$(".nextPageButton").click((function(){pageturning=!0,++currentPageNum+1>=numberOfPages&&(currentPageNum=numberOfPages-1,$(this).attr("disabled","disabled")),$(".prevPageButton").removeAttr("disabled","disabled"),checkPaging()}))}}paging&&checkPaging()}function findFirstTopic(e){var t=[];return function e(i){for(var a=0;a<i.Topics.length;a++)!1===i.Topics[a].IsBroken&&t.push(i.Topics[a]);if(i.Modules.length>0)for(var o=0;o<i.Modules.length;o++)e(i.Modules[o])}(e),t.sort((function(e,t){return e.SortOrder-t.SortOrder})),t[0]}function findNextIncomplete(e){var t=[];!function e(i){for(var a=0;a<i.Topics.length;a++)!1===i.Topics[a].IsBroken&&t.push(i.Topics[a]);if(i.Modules.length>0)for(var o=0;o<i.Modules.length;o++)e(i.Modules[o])}(e),t.sort((function(e,t){return e.SortOrder-t.SortOrder}));for(var i=0;i<t.length;i++)for(var a=0;a<tocCompletion.length;a++)if(tocCompletion[a].ObjectId===t[i].TopicId&&1===tocCompletion[a].RequiredItems&&0===tocCompletion[a].CompletedItems)return t[i]}function findNextUnread(e){var t=[];!function e(i){for(var a=0;a<i.Topics.length;a++)!1===i.Topics[a].IsBroken&&t.push(i.Topics[a]);if(i.Modules.length>0)for(var o=0;o<i.Modules.length;o++)e(i.Modules[o])}(e),t.sort((function(e,t){return e.SortOrder-t.SortOrder}));for(var i=0;i<t.length;i++)if(!0===t[i].Unread)return t[i]}var isHTML=RegExp.prototype.test.bind(/^(<([^>]+)>)$/i);function getLanguagePack(){parent.window.postMessage(JSON.stringify({subject:"getLangTerms",message:""}),"*")}function events(e){var t=JSON.parse(e.data);switch(t.subject){case"doneGetReplaceStrings":widget=t.message,timestamp=(new Date).getTime(),configDataPath=widget.instance.domain+widget.orgUnit.path+"custom_widgets/visual_toc/config.txt?v="+timestamp,sharedConfigPath=widget.instance.domain+"/shared/custom_widgets/visual_toc/config.txt?v="+timestamp,getConfigData();break;case"doneGetRoleDefinitions":roleDefs=t.message;break;case"doneGetLangTerms":if(terms=t.message,parent.window.postMessage(JSON.stringify({subject:"setFrameTitle",message:{title:terms.title}}),"*"),void 0===widget.orgUnit)return;var i={OrgUnitId:widget.orgUnit.id};parent.window.postMessage(JSON.stringify({subject:"doValenceRequest",message:{route:"getRoot",data:i}}),"*");break;case"doneValenceRequest":if(!t.message.dataArgument.ignoreWidget)switch(t.message.route){case"getRoot":toc.Modules=t.message.data,processRoot();break;case"getTOC":updateModule(processModule(t.message.data.Modules[0]));break;case"getWidgetDataConfigOrg":try{let e=JSON.parse(t.message.data.Data);processSharedConfig(!0,widgetData=e)}catch(e){widgetData=""}parent.window.postMessage(JSON.stringify({subject:"doValenceRequest",message:{route:"getWidgetDataConfig",data:{}}}),"*");break;case"getWidgetDataConfig":try{let e=JSON.parse(t.message.data.Data);processCourseConfig(!0,widgetData=e)}catch(e){widgetData=""}getLanguagePack();break;case"getCourseImage":courseImage="data:image/jpeg;base64,"+t.message.data}}}function setUsersCurrentModule(e){var t=$(".miletile")[e];$(t).addClass("userActive");var i=$(t).find(".front")[0],a=$(t).find(".back")[0];$(i).append('<div class="userActiveBorder"></div>'),$(a).append('<div class="userActiveBorder"></div>')}function editConfig(e){console.log("edit")}$(document).ready((function(){$.ajaxSetup({cache:!1}),init();const e=new ResizeObserver(e=>{resizeFrame()}),t=document.querySelector("body");e.observe(t),window.addEventListener("message",events,!1)})),$(window).resize((function(){clearTimeout(resizeId),resizeId=setTimeout(resizeFrame,500)})),$(window).on("orientationchange",(function(){paging&&checkPaging()})),$("#widgetconfig").append('<button onclick="editConfig();">widget config</button>');